<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <!-- TailwindCSS v3.4.16 (Sidebar.htmlê³¼ ë™ì¼ ë²„ì „) -->
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
</head>
<body class="bg-gray-50 p-6">
  <div class="max-w-md mx-auto">
    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
      âš™ï¸ Council-AI ì„¤ì •
    </h2>
    
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Backend API URL</label>
        <input 
          type="text" 
          id="api-url" 
          name="api-url"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="https://your-backend.com/api/v1"
        >
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
        <input 
          type="password" 
          id="api-key" 
          name="api-key"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="ìƒˆ API Key ì…ë ¥ (ë³€ê²½ ì‹œì—ë§Œ)"
        >
        <p id="api-key-status" class="text-xs text-gray-500 mt-1"></p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Google Picker API Key (ì„ íƒ)</label>
        <input 
          type="password" 
          id="picker-key" 
          name="picker-key"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Picker API Key (ë³€ê²½ ì‹œì—ë§Œ)"
        >
        <p class="text-xs text-gray-500 mt-1">Google Cloud Consoleì—ì„œ ë°œê¸‰ë°›ì€ API Key</p>
      </div>
      
      <hr class="my-4">
      
      <button 
        id="save-btn"
        class="w-full bg-blue-600 text-white py-2.5 rounded-lg hover:bg-blue-700 transition-colors font-medium"
      >
        ğŸ’¾ ì„¤ì • ì €ì¥
      </button>
      
      <button 
        id="close-btn"
        class="w-full bg-gray-200 text-gray-700 py-2.5 rounded-lg hover:bg-gray-300 transition-colors font-medium"
      >
        ë‹«ê¸°
      </button>
      
      <p id="status-message" class="text-center text-sm"></p>
    </div>
  </div>
  
  <script>
    // í˜„ì¬ ì„¤ì • ë¡œë“œ
    google.script.run
      .withSuccessHandler(function(settings) {
        document.getElementById('api-url').value = settings.apiBaseUrl || '';
        document.getElementById('api-key-status').textContent = 
          settings.hasApiKey ? 'âœ… í˜„ì¬ ì„¤ì •ë¨: ' + settings.apiKey : 'âš ï¸ ë¯¸ì„¤ì •';
      })
      .getAdminSettings();
    
    // ì €ì¥ ë²„íŠ¼
    document.getElementById('save-btn').addEventListener('click', function() {
      const btn = this;
      btn.disabled = true;
      btn.textContent = 'ì €ì¥ ì¤‘...';
      
      const settings = {
        apiBaseUrl: document.getElementById('api-url').value,
        apiKey: document.getElementById('api-key').value || null,
        pickerApiKey: document.getElementById('picker-key').value || null
      };
      
      google.script.run
        .withSuccessHandler(function(result) {
          btn.disabled = false;
          btn.textContent = 'ğŸ’¾ ì„¤ì • ì €ì¥';
          
          if (result.success) {
            document.getElementById('status-message').textContent = 'âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!';
            document.getElementById('status-message').className = 'text-center text-sm text-green-600';
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('api-key').value = '';
            document.getElementById('picker-key').value = '';
            
            // ì„¤ì • ë‹¤ì‹œ ë¡œë“œ
            google.script.run
              .withSuccessHandler(function(settings) {
                document.getElementById('api-key-status').textContent = 
                  settings.hasApiKey ? 'âœ… í˜„ì¬ ì„¤ì •ë¨: ' + settings.apiKey : 'âš ï¸ ë¯¸ì„¤ì •';
              })
              .getAdminSettings();
          } else {
            document.getElementById('status-message').textContent = 'âŒ ì €ì¥ ì‹¤íŒ¨: ' + result.error;
            document.getElementById('status-message').className = 'text-center text-sm text-red-600';
          }
        })
        .withFailureHandler(function(error) {
          btn.disabled = false;
          btn.textContent = 'ğŸ’¾ ì„¤ì • ì €ì¥';
          document.getElementById('status-message').textContent = 'âŒ ì˜¤ë¥˜: ' + error.message;
          document.getElementById('status-message').className = 'text-center text-sm text-red-600';
        })
        .saveAdminSettings(settings);
    });
    
    // ë‹«ê¸° ë²„íŠ¼
    document.getElementById('close-btn').addEventListener('click', function() {
      google.script.host.close();
    });
  </script>
</body>
</html>
