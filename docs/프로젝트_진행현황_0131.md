# 📘 Council-AI 프로젝트 진행 현황 보고서

> **작성일:** 2026년 1월 31일 21:00  
> **프로젝트명:** Council-AI (학생회 AI 비서)

---

## 1. 프로젝트 개요

### 1.1 목표
> **"복잡한 행정은 AI에게, 학생회는 학우에게 집중하도록."**

Google Workspace 기반의 문서 데이터 파이프라인을 구축하고, RAG(Retrieval-Augmented Generation)를 통해 학생회의 지식을 자산화하며, 반복적인 업무를 자동화하는 솔루션입니다.

### 1.2 핵심 가치
| 가치 | 설명 |
|------|------|
| **자산화** | 휘발되는 회의록과 자료를 '검색 가능한 DB'로 영구 저장 |
| **자동화** | 회의 결과 정리부터 캘린더 등록까지의 수작업 제거 |
| **연결성** | 별도 앱 설치 없이 기존 Google Docs 환경(Sidebar)에서 즉시 실행 |

---

## 2. 핵심 기능 명세

### 2.1 회의 자동화 (Smart Minutes)
- **입력:** 안건지(Google Docs ID) + 녹음본/속기록 텍스트
- **처리 과정:**
  1. Docs API로 안건지 템플릿 로드
  2. LLM이 속기록 분석 → `결정 사항`, `액션 아이템` 추출
  3. 템플릿 Placeholder 치환 (`batchUpdate`)
- **출력:** 완성된 결과지 Docs 생성

### 2.2 지능형 지식 DB (Hybrid RAG) - 핵심 기능
- **파이프라인:** Ingestion → Parsing → Enrichment → Indexing
- **검색:** 질문 → 임베딩 → Cosine Similarity → LLM 답변
- **비즈니스 로직:** '간식', '회식' 키워드 시 제휴 업체 정보 함께 검색

### 2.3 스마트 캘린더 (Shared Calendar)
- 공유 캘린더 구독 방식
- 결과지에서 `[날짜]`, `[담당자]`, `[할일]` 추출 → Google Calendar 이벤트 생성

---

## 3. 기술 스택 (GCP Native)

| 구분 | 기술 | 설명 |
|------|------|------|
| **Frontend** | Google Apps Script (GAS) | 구글 닥스 사이드바 내 동작, HTML/CSS/JS UI |
| **Backend** | FastAPI (Python 3.11) | 비동기 처리 최적화, AI 라이브러리 호환성 |
| **Infrastructure** | GCP Compute Engine | e2-medium 인스턴스, Docker & Docker Compose |
| **Parsing** | Upstage Doc Parser API | 표(Table) 구조 인식 및 HTML 변환 |
| **AI Models** | Gemini 1.5 Flash | 1M Token Context, Vision 캡셔닝 |
| **Storage** | Google Cloud Storage (GCS) | 이미지 원본 저장소 |
| **Database** | PostgreSQL 16 + pgvector | 정형/비정형 데이터 통합 관리, Docker 컨테이너 |
| **Task Queue** | Celery + Redis | 비동기 작업 처리 |
| **Auth** | Google Service Account | ADC(Application Default Credentials) 방식 |

---

## 4. 데이터 파이프라인 상세

### 4.1 전체 흐름도
```
Google Drive → Download/Export → Upstage Parse → Image Caption (Gemini)
                                      ↓
                              Text Chunking (LangChain)
                                      ↓
                              Embedding (Gemini)
                                      ↓
                              PostgreSQL + pgvector
```

### 4.2 7단계 파이프라인

| 단계 | 이름 | 설명 | 구현 파일 |
|------|------|------|----------|
| **Step 1** | Ingestion (수집) | Google Drive에서 파일 다운로드, Docs/Sheets → docx/xlsx 변환 | `step_01_ingest.py` |
| **Step 2** | Classification (분류) | 문서 유형 분류 (회의록, 보고서, 일반문서 등) | `step_02_classify.py` |
| **Step 3** | Parsing (구조화) | Upstage API로 HTML/Markdown 변환, 표 구조 보존 | `step_03_parse.py` |
| **Step 4** | Preprocessing (전처리) | 텍스트 정제, 노이즈 제거 | `step_04_preprocess.py` |
| **Step 5** | Chunking (분할) | Parent-Child 청킹, 시맨틱 단위 분할 | `step_05_chunk.py` |
| **Step 6** | Enrichment (보강) | DB 저장, Access Level 결정, 이벤트 매핑 | `step_06_enrich.py` |
| **Step 7** | Embedding (임베딩) | Vertex AI 임베딩, pgvector 저장 | `step_07_embed.py` |

---

## 5. 프로젝트 구조

```
week4/
├── README.md                 # 프로젝트 설명서
├── CLAUDE.md                 # AI 개발 지침서
├── docker-compose.yml        # Docker 서비스 구성
├── .env.example              # 환경변수 템플릿
│
├── backend/                  # FastAPI 백엔드
│   ├── Dockerfile
│   ├── requirements.txt
│   ├── app/
│   │   ├── main.py           # FastAPI 앱 진입점
│   │   ├── core/             # 설정, 보안, DB 연결
│   │   ├── api/v1/           # API 엔드포인트
│   │   ├── models/           # SQLAlchemy ORM 모델
│   │   ├── schemas/          # Pydantic 스키마
│   │   ├── services/         # 비즈니스 로직
│   │   ├── pipeline/         # 7단계 파이프라인
│   │   └── tasks/            # Celery 비동기 작업
│   └── tests/                # 테스트 코드
│
├── frontend/                 # Google Apps Script
│   ├── appsscript.json
│   └── src/
│
└── docs/                     # 기획 및 설계 문서
```

---

## 6. 현재 진행 상황 (2026년 1월 31일 기준)

### 6.1 영역별 완성도

| 영역 | 완성도 | 상태 | 비고 |
|------|--------|------|------|
| **Ingestion (수집)** | 100% | ✅ 완료 | Google Drive API 연동 완료 |
| **Classification (분류)** | 70% | 🟡 진행중 | 기본 분류 로직 구현됨 |
| **Parsing (구조화)** | 100% | ✅ 완료 | Upstage API 연동 완료 |
| **Preprocessing (전처리)** | 90% | ✅ 거의 완료 | 텍스트 정제 로직 구현됨 |
| **Chunking (분할)** | 100% | ✅ 완료 | Parent-Child 청킹 구현됨 |
| **Enrichment (보강)** | 95% | ✅ 거의 완료 | DB 저장, 이벤트 매핑 구현됨 |
| **Embedding (임베딩)** | 95% | ✅ 거의 완료 | Vertex AI 연동 구현됨 |
| **Search API** | 10% | 🔴 미구현 | 빈 배열 반환 상태 |
| **LLM Answer** | 0% | 🔴 미구현 | 구현 필요 |
| **API → Celery 연결** | 50% | 🟡 진행중 | 코드 존재하나 주석 처리됨 |

### 6.2 최근 구현 완료 항목 (1월 31일)

1. **✅ Celery 7단계 오케스트레이션**
   - `tasks/pipeline.py`에서 7개 Step이 하나의 Task에서 순차 실행되도록 구현

2. **✅ Chunk → DB 저장 로직**
   - `step_06_enrich.py`에서 Parent/Child chunks 생성 및 DB 저장 구현
   - access_level, section_header 주입 기능 추가

3. **✅ N:M Event-Chunk 관계**
   - `DocumentChunk` 모델에 `related_event_id`, `inferred_event_title` 필드 추가

---

## 7. 남은 작업 및 우선순위

### 7.1 긴급 (Critical) - 예상 소요 시간: 1시간

| 우선순위 | 작업 | 파일 | 예상 시간 |
|---------|------|------|----------|
| **1** | API → Celery 연결 활성화 | `api/v1/rag.py` | 15분 |
| **2** | Task Status API 구현 | `api/v1/tasks.py` | 15분 |
| **3** | Search API 기본 구현 | `api/v1/rag.py` | 30분 |

### 7.2 중요 (High) - 예상 소요 시간: 2-3시간

| 작업 | 설명 |
|------|------|
| LLM Answer 생성 | 검색 결과 기반 Gemini 답변 생성 로직 |
| ChatLog 테이블 구현 | 대화 이력 저장 모델 |
| 오류 처리 강화 | 파이프라인 실패 시 복구 로직 |

### 7.3 보통 (Medium) - 예상 소요 시간: 3-5시간

| 작업 | 설명 |
|------|------|
| Frontend GAS 개발 | 사이드바 UI 완성 |
| 테스트 코드 작성 | API 엔드포인트 테스트 |
| 배포 스크립트 | GCP 배포 자동화 |

---

## 8. API 엔드포인트 현황

| 엔드포인트 | 메서드 | 상태 | 설명 |
|------------|--------|------|------|
| `/api/v1/rag/ingest/folder` | POST | 🟡 | 폴더 수집 요청 (Celery 연결 필요) |
| `/api/v1/rag/search` | POST | 🔴 | 벡터 검색 + LLM 답변 (미구현) |
| `/api/v1/rag/documents` | GET | ✅ | 인덱싱된 문서 목록 |
| `/api/v1/tasks/{task_id}` | GET | 🔴 | Task 상태 조회 (하드코딩 상태) |
| `/api/v1/minutes/process` | POST | 🟡 | 회의록 처리 요청 |
| `/api/v1/calendar/events` | POST | 🟡 | 캘린더 이벤트 생성 |
| `/health` | GET | ✅ | 헬스 체크 |

---

## 9. 실행 방법

### 9.1 환경 설정
```bash
# 환경변수 파일 생성
cp .env.example .env

# .env 파일 편집 (실제 값 입력)
# - GEMINI_API_KEY
# - UPSTAGE_API_KEY
# - GOOGLE_CLOUD_PROJECT
# - GOOGLE_APPLICATION_CREDENTIALS
```

### 9.2 Docker로 실행
```bash
# 전체 서비스 시작
docker-compose up -d

# 로그 확인
docker-compose logs -f backend

# 서비스 중지
docker-compose down
```

### 9.3 로컬 개발
```bash
cd backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

---

## 10. 결론

| 항목 | 평가 |
|------|------|
| **전체 진척도** | 🟡 **약 70%** - 파이프라인 코어 로직 대부분 완성 |
| **기획 정합성** | 🟡 **부분 일치** - DB/Pipeline은 정합, API 연결은 미완 |
| **배포 가능성** | 🔴 **불가** - API → Celery Task 연결 비활성화 상태 |
| **예상 남은 작업** | ⏱ **약 6-9시간** (Critical 1시간 + High 3시간 + Medium 5시간) |

> **핵심 과제:** API 엔드포인트에서 Celery Task를 실제로 호출하도록 주석 해제 및 연결하고, Search API를 구현하여 E2E 흐름을 완성해야 합니다.

---

*이 문서는 프로젝트 진행 상황을 추적하기 위한 것으로, 개발 진행에 따라 지속적으로 업데이트됩니다.*
